from flask import Flask, request, jsonify
import os
import asyncio
from sydney import SydneyClient

app = Flask(__name__)
async def ai_model(quest):
    # Manually set cookies here
    os.environ["BING_COOKIES"] = "MUID=3EF41DDE811F60372D3E0E6A80CA61E8; MC1=GUID=cd98ca3b28d34fd58fe429c84788126d&HASH=cd98&LV=202310&V=4&LU=1698572961899; _fbp=fb.1.1699287014476.1706647711; _clck=3mh7s1%7C2%7Cfi2%7C0%7C1405; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C19744%7CMCMID%7C81087272573899667470267195241418284281%7CMCAAMLH-1706469925%7C12%7CMCAAMB-1706469925%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCCIDH%7C953711486%7CMCOPTOUT-1705872325s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C4.4.0; msresearch=%7B%22state%22%3A%7B%22name%22%3A%22IDLE%22%7D%2C%22userid%22%3A%2217058652593771886918314930652%22%7D; _uetvid=cc608c80e5e611ed8a4479f3bdff1c1f; _uetmsclkid=_uet4a35c5af24a71b5decc6a0024b8467b2; mbox=session#9136779a800645d0840131d4f0f0bcc9#1705866644|PC#9136779a800645d0840131d4f0f0bcc9.41_0#1740052172; MUIDB=3EF41DDE811F60372D3E0E6A80CA61E8; _EDGE_S=SID=17A329804DE667F305B53D904C0E66D5; USRLOC=HS=1; SRCHD=AF=NOFORM; SRCHUID=V=2&GUID=26022345A63843CE847BD027E885AEC5&dmnchg=1; _Rwho=u=d; CSRFCookie=110239b3-0524-48d6-9f77-65a2e21db72a; SRCHUSR=DOB=20240124&POEX=W; ANON=A=F1685A9B8A92A6DF448F5155FFFFFFFF&E=1d54&W=1; NAP=V=1.9&E=1cfa&C=q4oVH0dqXZzTcQsRkh7pHXbyI802VODDRDvRgJHv5iosOQh5DbO79Q&W=1; PPLState=1; KievRPSSecAuth=FACaBBRaTOJILtFsMkpLVWSG6AN6C/svRwNmAAAEgAAACN+ZEC3ekcgWWAQg56dYhEoLOr7QF25yWfn5EkkkUE71cl2PU39MYnML+i/Z6vYMIM/ExyEwXGCkQSZbdBnJwfZdxVgYrxs6vpNUTDgy9qMs0ohELhVHVE3FXyiGcMTEx+Wqk218DNpZsp16TdYuIa+0xPpw4Q+JhGlFJwVWlGs/DK5pFgBvFmTwZAneZ8K1NFIQUPzGi3BMFM08j8rzlWS7/dzyKF6lkbrAkLi40wMGGJOhKUev8E1UuF7wRPInxSyZDXZOy3vsiBmpZ1mJPcEzRjHpzkVeYQ2T9JDULNom61ereLljjwx6Zpf3BdV7aL9dI2PgDB/xiKYTNnJytYBDud9gV0TxXb4Maqioskbl8PBHz3T6eu4YIWyjXbTG4uZXtzfCWAYTZutO0Gur3vjjWudhnocZzbtn6oCo2zW/WIAu5WFB9OwkFYgd3dDnmV8qtJyx0Lc/3mureYECfu9fmqi70/KZo+Diu40eR2MQtHRPEyLLiVUxrsWKcNe0yRHsOA8OKM68NEjpYCqYOiiyxxdXmU41qQOuW+AiHd9jRHQmoJ/Ow11djFfuSRgcWjPt/6OJIm5z1qqdrcvEUhDY7n9Yvzy76TGLuXj0MIAAiecplbwRTMKwxnKVIlv0e2NJsrwkjr8cllhRh98G/iQU+808dG1vEyunVitWdbyIYBLNtHzCIbhvtga+5F+u8x8Q3MpgUMV8yxbRV/ftZ7CRQwOb3Kd3kbviLsackdZnYA4NtqZu16HkP0BAiJsCB5adQs6b97U4Pf0DwzcLOXMFNwG3vxC4B0Wyl85bA+PLaA0MH5Y8tOdUo6O2CehUxZ4JGIUQ0ddKGZT4xPu6QetkC0qPT5V0iv3zjODtYtlHpz+4Aex9Zf5Nbs6dVWrcdIxlaTnNvUn+q+g0VMfMGwEVs//+k8Y0hORlPElsSWrbnjNpFBIPT3dXfeiYLF5OlqIeUdGumrjzuLD00zkYOhqtJ9j4xXNcv/IABskov8T647k1dEhl6FTBcC9qQin1oAvbZz0EusHEgwaPOD2l/zSnK+i2BJX+44Et07cFXPpv4BOrOCKjdfEmdMtNSZOg8PrrGEve5pnXNG/e6Yv0vHU2xA+VI9Q2jpKGrTBtO1z4G+MVjarP1U6d1NmJwwa0T1CZKEpi2ok7lHmGIas0m5i2nNB3/PMpgKgPoxNTY0IE9sHfBiAavbMIxd/TBClnM+2cRhSGjNZJgYenh68sm62pXEUdgRXwSwqbDbYaAkR2GXB3tYRYbrXDt2RItXUviRg9hFRYM4F9HCUHvNznaB8cTlpD4y7EY4tav1eezMO2gOVLSD8NBPV2M5AMHAcSrG6/4Kie+Gf6i0hIoAFV6bjnwbI+1BdhZtDEVxtAFxCj0byN18qh0fEOoAFHNrnzwvUeGMijXC7YfeVwgiFBY3CVx+ia1yIF0AWw3cTQsIXiy/889TJKsuB2DfWOI85sokDpoCkEqrZ5ND+2Yu3IR6KFrxQAXssWnC3+3Yg4Dje28STDUzE7Sk0=; _U=1YJCw0ns1DxBxm-8kI7Vtex0P-TexBpTDTry8AH9i2thGJl-XtDj2PSu3wgVFirW5EIkkR9DdKSNBqj8sJUqRuhz3ZW8hJBEBNx7bSbQ9q643t4RFJltqzWOX8yA3FwVdleaZbNaFLCEEwXceEaOn5Sje9m4GSTZVH9bpxyjLWCUT5U1Bhv2YPMDIh8h0YiceynFS9AvutUha0i48ILK55jsnuLCmLsImCHi_k06fbv0; WLS=C=19649d32cf8cabf1&N=om+Prakash; WLID=4wmnvcdvo51CQHKuQFFCA5s3OcQ6SdJJoyZ292+ZfvlpiqW4nKtHZkAdecQbaEC9I01TAjOxDo8nqUwEudm9P2FFOqYh8lTxcl4ntjZK1wk=; _SS=SID=17A329804DE667F305B53D904C0E66D5&R=1002&RB=1002&GB=0&RG=0&RP=0; _RwBf=r=0&ilt=1&ihpd=1&ispd=0&rc=1002&rb=1002&gb=0&rg=0&pc=0&mtu=0&rbb=0.0&g=0&cid=&clo=0&v=2&l=2024-01-23T08:00:00.0000000Z&lft=0001-01-01T00:00:00.0000000&aof=0&ard=0001-01-01T00:00:00.0000000&rwdbt=2024-01-21T06:29:54.6850278-08:00&o=0&p=sapphire&c=true&t=5546&s=2023-04-14T05:57:35.5743569+00:00&ts=2024-01-24T07:13:00.6601585+00:00&rwred=0&wls=2&wlb=0&wle=0&ccp=0&lka=0&lkt=0&aad=0&TH=&mta=0&e=UgnT2G9bqQMZvV1BJyvPpg-7wo6RvzJJ_f3g2pUHiih-zHLzdNG_xlSGWTorTpGTLgx7TRjC8q-Y44YebD94JA&A=F1685A9B8A92A6DF448F5155FFFFFFFF; MS0=36464ec341bc4e3eabb840e45b63d487; SRCHHPGUSR=SRCHLANG=en&PV=15.0.0&HV=1706080381&BRW=NOTP&BRH=M&CW=487&CH=742&SCW=487&SCH=742&DPR=1.3&UTC=330&DM=1&CIBV=1.1498.2&PRVCW=1488&PRVCH=742&copucnt=1"
    ret = ""
    sydney = SydneyClient(style="balanced")
    async with SydneyClient() as sydney:
        response = await sydney.ask(quest, citations=True)
        ret = response
    return ret
@app.route('/', methods=['GET'])
def your_api_endpoint():
    quest = request.args.get('quest')
    if not quest:
        return jsonify({'error': 'Missing required parameter: quest'}), 400
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    response = loop.run_until_complete(ai_model(quest))
    return response
# if __name__ == '__main__':
#     app.run(debug=True, port=5010, use_reloader=False)